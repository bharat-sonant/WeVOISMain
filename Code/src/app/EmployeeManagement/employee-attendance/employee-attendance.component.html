<section class="header">
    <div class="row no-gutters">
        <div class="col-md-12 col-lg-12 col-xl-12 main-headers Employees-heading">
            Employees Attendance
        </div>
    </div>
</section>
<div class="main-content">
    <div class="row">
        <div class="col-md-12 card-outer">
            <div id="divLoader" class="loaderClass">
                <img src="../../../assets/img/loading.gif" width="50" class="imgLoader">
            </div>
            <div class="card custom-header-outer">
                <div class="card-header custom-header">
                    <div class="row">

                        <div class="col-md-12 text-left date-box" style="padding-left:20px;height: 50px;">
                            <input type="radio" id="rdoByDate" [checked]="filterType=='byDate'"
                                (change)="setFilterType('byDate','0')"> <label>&nbsp;Filter By Date</label>
                            &nbsp;&nbsp;&nbsp; <input type="radio" id="rdoByEmployee"
                                [checked]="filterType=='byEmployee'" (change)="setFilterType('byEmployee','0')">
                            <label>&nbsp;Filter By
                                Employee</label>
                            <span [hidden]="filterType=='byDate'">
                                <input id="chkIncludeInactive" type="checkbox" (change)="getFilterEmployee()"
                                    style="margin-left: 20px;">
                                <label>&nbsp; Include In-Active Employee</label></span>

                            <span class="export-span">
                                <i class="fa-solid fa-file-export export-icon" (click)="exportToExcel();"></i><br />
                                <span class="export-span-iner">Export</span>
                            </span>
                        </div>
                        <hr />
                    </div>
                    <div id="divByDate" class="row" style="padding-left:20px;" [hidden]="filterType=='byEmployee'">
                        <div class="col-md-12 text-left date-box">
                            <button (click)="setDate('','previous');" class="btn-hvr arrow-btn">
                                << </button>
                                    <input id="txtDate" class="filter-select text-input" type="date"
                                        (change)="setDate($event.target.value,'current')">
                                    <button (click)="setDate('','next');" class="btn-hvr arrow-btn2">
                                        >>
                                    </button>

                                    <select id="ddlTime" class="filter-select filter-input" (change)="filterData()"
                                        style="width:130px ;">
                                        <option value="0">
                                            All
                                        </option>
                                        <option value="08:10">
                                            After 8:10
                                        </option>
                                        <option value="08:30">
                                            After 8:30
                                        </option>


                                    </select>

                                    <input type="checkbox" id="chkFieldExecutive" (change)="filterData()"
                                        style="margin-left: 10px;"> &nbsp;Field Executive

                                        <input id="chkNotApproved" type="checkbox" (change)="filterData()"
                                        style="margin-left: 20px;"> &nbsp;Attendance Not Approved <b> ({{notApprovedCount}})</b>
                        </div>
                    </div>
                    <div id="divByEmployee" class="row" [hidden]="filterType=='byDate'">
                        <div class="col-md-12">
                            <select id="ddlEmployee" class="filter-select filter-input" style="width: 300px;">
                                <option value="0">
                                    --Select--
                                </option>
                                <option value="{{dt.empId}}" *ngFor="let dt of filterEmployeeList;">
                                    {{dt.name}} ({{dt.empCode}})
                                </option>
                            </select>
                            <input id="txtDateFrom" class="filter-select text-input" type="date"
                                style="width: 100px; margin-left: 10px;">
                            <input id="txtDateTo" class="filter-select text-input" type="date"
                                style="width: 100px; margin-left: 10px;">
                            <button class="btn btn-success" style="margin-top:10px ;"
                                (click)="getAttendanceByEmployee();">Search</button>
                                <input id="chkNotApprovedEmployee" type="checkbox" (change)="filterDataEmployee()"
                                style="margin-left: 20px;"> &nbsp;Attendance Not Approved <b>({{notApprovedCount}})</b>
                                <span (click)="openLocation(contentLocation,0,'All')" style="cursor: pointer; margin-left: 20px; "> <i class="fa-solid fa-map-location-dot"
                                    style="font-size: 14px; color: #2dbd23;"
                                    ></i> Show All Location</span>
                        </div>

                    </div>
                </div>
                <div class="card-body">
                    <form>
                        <div class="row">
                            <div class="col-md-12 pr-1">
                                <div id="divList" class="table-wrapper table-one">
                                    <table class="table table-line">
                                        <thead>
                                            <th class="text-left br-1 table-heading1"
                                                [hidden]="filterType=='byEmployee'">
                                                Name</th>
                                            <th class="text-left br-1 table-heading1 " [hidden]="filterType=='byDate'">
                                                Date</th>
                                            <th class="text-left br-1 table-heading1 ">
                                                In</th>
                                            <th class="text-left br-1 table-heading1 ">
                                                Out
                                            </th>
                                            <th class="text-left br-1 table-heading1 ">
                                                Hrs
                                            </th>

                                            <th class="text-left br-1 table-heading1 col-w">
                                                In Location
                                            </th>
                                            <th class="text-left br-1 table-heading1 col-w">
                                                Out Location
                                            </th>
                                            <th class="text-left br-1 table-heading1">
                                                Status
                                            </th>
                                            <th class="text-left br-1 table-heading1 col-w"
                                                [hidden]="isAttendanceApprover=='0'">
                                                Approver
                                            </th>
                                        </thead>
                                        <tbody>
                                            <tr id="tr{{i}}" *ngFor="let data of attendanceList; let i=index" >
                                                <td class="text-left br-1" [hidden]="filterType=='byEmployee'"
                                                    style="cursor: pointer; width:20%!important"
                                                    (click)="setFilterType('byEmployee',data.empId)">
                                                    {{data.name}} <b>[{{data.empCode}}]</b>
                                                </td>
                                                <td class="text-left br-1" [hidden]="filterType=='byDate'" style=" width:10%!important;">
                                                    {{data.name}}
                                                </td>
                                                <td class="text-left br-1" class="{{data.cssClass}}" style=" width:5%!important;">
                                                    {{data.inTime}}
                                                </td>
                                                <td class="text-left br-1" style=" width:5%!important;">
                                                    {{data.outTime}}
                                                </td>
                                                <td class="text-left br-1" class="{{data.cssWorkingClass}}" style=" width:10%!important;">
                                                    {{data.workingHour}}
                                                </td>
                                                <td class="text-left br-1" style=" width:20%!important;">
                                                   <span> {{data.inLocation}}</span>
                                                   <i class="fa-solid fa-map-location-dot"
                                                   style="float: right; font-size: 14px; cursor: pointer; color: #2dbd23;"
                                                   (click)="openLocation(contentLocation,i,'single')"></i>
                                                </td>
                                                <td class="text-left br-1" style=" width:20%!important;">
                                                    {{data.outLocation}}
                                                </td>
                                                <td class="text-left br-1"
                                                style=" width:10%!important;">
                                                    <span> {{data.status}}</span>
                                                    <i class="fa-solid fa-person-circle-check"
                                                        style="float: right; font-size: 14px; cursor: pointer; color: #2dbd23;"
                                                        [hidden]="isAttendanceApprover=='0'"
                                                        (click)="openApprovePopup(contentApprove,i,data.approverStatus);"></i>
                                                </td>
                                                <td class="text-left br-1" [hidden]="isAttendanceApprover=='0'" style=" width:12%!important">
                                                    {{data.approveBy}}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #contentApprove>
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <input type="hidden" id="hddEmpId" value="0">
            <input type="hidden" id="hddDate" value="">
            <input type="hidden" id="hddIndex" value="0">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Approve Attendance</h5>
                <img src="../../../assets/img/close-grey.png" class="img-close" (click)="cancelApprove();">
            </div>
            <div class="modal-body">
                <div class="row">
                    <select id="ddlStatus" class="filter-select filter-input">
                        <option value="0">Not Approved</option>
                        <option value="1">Full Day</option>
                        <option value="2">Pre Lunch</option>
                        <option value="3">Post Lunch</option>
                        <option value="4">Absent</option>
                    </select>

                </div>
                <div class="row">
                    <div class="col-md-6" style="text-align: center;margin-top: 15px;">
                        <button class="btn btn-success" (click)="approveAttendance()"
                            style="text-transform: uppercase;">
                            Confirm</button>
                    </div>
                    <div class="col-md-6" style="text-align: center;margin-top: 5px;">
                        <button class="btn btn-danger " (click)="cancelApprove()" style="text-transform: uppercase;">
                            Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>


<ng-template #contentLocation>
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="lblName"></h5>
                <img src="../../../assets/img/close-grey.png" class="img-close" (click)="cancelApprove();">
            </div>
            <div class="modal-body">
                <div id="divLocation" class="row" style="border-bottom: 1px solid lightgray;">
                    <div class="col-md-12" >
                       <b> In Location : </b> <label id="lblInLocation"></label>
                    </div>
                    <div class="col-md-12" >
                       <b> Out Location : </b> <label id="lblOutLocation"></label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12" style="margin-top: 10px;" >
                        <div id="locationtMap" style="width:100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>